"use strict";var _a;Object.defineProperty(exports,"__esModule",{value:!0}),exports.TriggerInvalidation=exports.Trigger=exports.InvocationType=void 0;const jsiiDeprecationWarnings=require("../../.warnings.jsii.js"),JSII_RTTI_SYMBOL_1=Symbol.for("jsii.rtti"),path_1=require("path"),constructs_1=require("constructs"),core_1=require("../../core");var InvocationType;(function(InvocationType2){InvocationType2.EVENT="Event",InvocationType2.REQUEST_RESPONSE="RequestResponse",InvocationType2.DRY_RUN="DryRun"})(InvocationType=exports.InvocationType||(exports.InvocationType={}));class Trigger extends constructs_1.Construct{constructor(scope,id,props){super(scope,id);try{jsiiDeprecationWarnings.aws_cdk_lib_triggers_TriggerProps(props)}catch(error){throw process.env.JSII_DEBUG!=="1"&&error.name==="DeprecationError"&&Error.captureStackTrace(error,Trigger),error}const handlerArn=this.determineHandlerArn(props),provider=core_1.CustomResourceProvider.getOrCreateProvider(this,"AWSCDK.TriggerCustomResourceProvider",{runtime:(0,core_1.builtInCustomResourceProviderNodeRuntime)(this),codeDirectory:(0,path_1.join)(__dirname,"lambda")});provider.addToRolePolicy({Effect:"Allow",Action:["lambda:InvokeFunction"],Resource:[`${props.handler.functionArn}:*`]}),new core_1.CustomResource(this,"Default",{resourceType:"Custom::Trigger",serviceToken:provider.serviceToken,properties:{HandlerArn:handlerArn,InvocationType:props.invocationType??"RequestResponse",Timeout:props.timeout?.toMilliseconds().toString()??core_1.Duration.minutes(2).toMilliseconds().toString()}}),this.executeAfter(...props.executeAfter??[]),this.executeBefore(...props.executeBefore??[])}executeAfter(...scopes){constructs_1.Node.of(this).addDependency(...scopes)}executeBefore(...scopes){for(const s of scopes)constructs_1.Node.of(s).addDependency(this)}determineHandlerArn(props){return props.handler.currentVersion.functionArn}}_a=JSII_RTTI_SYMBOL_1,Trigger[_a]={fqn:"aws-cdk-lib.triggers.Trigger",version:"2.80.0"},exports.Trigger=Trigger;var TriggerInvalidation;(function(TriggerInvalidation2){TriggerInvalidation2.HANDLER_CHANGE="WHEN_FUNCTION_CHANGES"})(TriggerInvalidation=exports.TriggerInvalidation||(exports.TriggerInvalidation={}));
