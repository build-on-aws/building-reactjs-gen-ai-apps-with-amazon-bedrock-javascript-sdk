{"version":3,"file":"serverContext.js","sources":["../../../../src/adapterCore/serverContext/serverContext.ts"],"sourcesContent":["\"use strict\";\n// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.destroyAmplifyServerContext = exports.getAmplifyServerContext = exports.createAmplifyServerContext = void 0;\nconst serverContextRegistry_1 = require(\"./serverContextRegistry\");\nconst singleton_1 = require(\"../../singleton\");\nconst error_1 = require(\"../error\");\n/**\n * Creates an Amplify server context.\n * @param amplifyConfig The Amplify resource config.\n * @param libraryOptions The Amplify library options.\n * @returns The Amplify server context spec.\n */\nconst createAmplifyServerContext = (amplifyConfig, libraryOptions) => {\n    const amplify = new singleton_1.AmplifyClass();\n    amplify.configure(amplifyConfig, libraryOptions);\n    return serverContextRegistry_1.serverContextRegistry.register({\n        amplify,\n    });\n};\nexports.createAmplifyServerContext = createAmplifyServerContext;\n/**\n * Returns an Amplify server context.\n * @param contextSpec The context spec used to get the Amplify server context.\n * @returns The Amplify server context.\n */\nconst getAmplifyServerContext = (contextSpec) => {\n    assertContextSpec(contextSpec);\n    const context = serverContextRegistry_1.serverContextRegistry.get(contextSpec);\n    if (context) {\n        return context;\n    }\n    throw new error_1.AmplifyServerContextError({\n        message: 'Attempted to get the Amplify Server Context that may have been destroyed.',\n        recoverySuggestion: 'Ensure always call Amplify APIs within `runWithAmplifyServerContext` function, and do not attempt to reuse `contextSpec` object.',\n    });\n};\nexports.getAmplifyServerContext = getAmplifyServerContext;\n/**\n * Destroys an Amplify server context.\n * @param contextSpec The context spec used to destroy the Amplify server context.\n */\nconst destroyAmplifyServerContext = (contextSpec) => {\n    serverContextRegistry_1.serverContextRegistry.deregister(contextSpec);\n};\nexports.destroyAmplifyServerContext = destroyAmplifyServerContext;\nconst assertContextSpec = (contextSpec) => {\n    let invalid = false;\n    if (!Object.prototype.hasOwnProperty.call(contextSpec, 'token')) {\n        invalid = true;\n    }\n    else if (!Object.prototype.hasOwnProperty.call(contextSpec.token, 'value')) {\n        invalid = true;\n    }\n    else if (Object.prototype.toString.call(contextSpec.token.value) !==\n        '[object Symbol]') {\n        invalid = true;\n    }\n    if (invalid) {\n        throw new error_1.AmplifyServerContextError({\n            message: 'Invalid `contextSpec`.',\n            recoverySuggestion: 'Ensure to use the `contextSpec` object injected by `runWithAmplifyServerContext` function.',\n        });\n    }\n};\n"],"names":[],"mappings":";;AACA;AACA;AACA,MAAM,CAAC,cAAc,CAAC,OAAO,EAAE,YAAY,EAAE,EAAE,KAAK,EAAE,IAAI,EAAE,CAAC,CAAC;AAC9D,OAAO,CAAC,2BAA2B,GAAG,OAAO,CAAC,uBAAuB,GAAG,OAAO,CAAC,0BAA0B,GAAG,KAAK,CAAC,CAAC;AACpH,MAAM,uBAAuB,GAAG,OAAO,CAAC,yBAAyB,CAAC,CAAC;AACnE,MAAM,WAAW,GAAG,OAAO,CAAC,iBAAiB,CAAC,CAAC;AAC/C,MAAM,OAAO,GAAG,OAAO,CAAC,UAAU,CAAC,CAAC;AACpC;AACA;AACA;AACA;AACA;AACA;AACA,MAAM,0BAA0B,GAAG,CAAC,aAAa,EAAE,cAAc,KAAK;AACtE,IAAI,MAAM,OAAO,GAAG,IAAI,WAAW,CAAC,YAAY,EAAE,CAAC;AACnD,IAAI,OAAO,CAAC,SAAS,CAAC,aAAa,EAAE,cAAc,CAAC,CAAC;AACrD,IAAI,OAAO,uBAAuB,CAAC,qBAAqB,CAAC,QAAQ,CAAC;AAClE,QAAQ,OAAO;AACf,KAAK,CAAC,CAAC;AACP,CAAC,CAAC;AACF,OAAO,CAAC,0BAA0B,GAAG,0BAA0B,CAAC;AAChE;AACA;AACA;AACA;AACA;AACA,MAAM,uBAAuB,GAAG,CAAC,WAAW,KAAK;AACjD,IAAI,iBAAiB,CAAC,WAAW,CAAC,CAAC;AACnC,IAAI,MAAM,OAAO,GAAG,uBAAuB,CAAC,qBAAqB,CAAC,GAAG,CAAC,WAAW,CAAC,CAAC;AACnF,IAAI,IAAI,OAAO,EAAE;AACjB,QAAQ,OAAO,OAAO,CAAC;AACvB,KAAK;AACL,IAAI,MAAM,IAAI,OAAO,CAAC,yBAAyB,CAAC;AAChD,QAAQ,OAAO,EAAE,2EAA2E;AAC5F,QAAQ,kBAAkB,EAAE,kIAAkI;AAC9J,KAAK,CAAC,CAAC;AACP,CAAC,CAAC;AACF,OAAO,CAAC,uBAAuB,GAAG,uBAAuB,CAAC;AAC1D;AACA;AACA;AACA;AACA,MAAM,2BAA2B,GAAG,CAAC,WAAW,KAAK;AACrD,IAAI,uBAAuB,CAAC,qBAAqB,CAAC,UAAU,CAAC,WAAW,CAAC,CAAC;AAC1E,CAAC,CAAC;AACF,OAAO,CAAC,2BAA2B,GAAG,2BAA2B,CAAC;AAClE,MAAM,iBAAiB,GAAG,CAAC,WAAW,KAAK;AAC3C,IAAI,IAAI,OAAO,GAAG,KAAK,CAAC;AACxB,IAAI,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,cAAc,CAAC,IAAI,CAAC,WAAW,EAAE,OAAO,CAAC,EAAE;AACrE,QAAQ,OAAO,GAAG,IAAI,CAAC;AACvB,KAAK;AACL,SAAS,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,cAAc,CAAC,IAAI,CAAC,WAAW,CAAC,KAAK,EAAE,OAAO,CAAC,EAAE;AAChF,QAAQ,OAAO,GAAG,IAAI,CAAC;AACvB,KAAK;AACL,SAAS,IAAI,MAAM,CAAC,SAAS,CAAC,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,KAAK,CAAC;AACpE,QAAQ,iBAAiB,EAAE;AAC3B,QAAQ,OAAO,GAAG,IAAI,CAAC;AACvB,KAAK;AACL,IAAI,IAAI,OAAO,EAAE;AACjB,QAAQ,MAAM,IAAI,OAAO,CAAC,yBAAyB,CAAC;AACpD,YAAY,OAAO,EAAE,wBAAwB;AAC7C,YAAY,kBAAkB,EAAE,4FAA4F;AAC5H,SAAS,CAAC,CAAC;AACX,KAAK;AACL,CAAC;;"}